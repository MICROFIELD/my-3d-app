<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Pro Max Dashboard - Final</title>
    <style>
        :root {
            --primary: #ffcc00;
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --accent-red: #ef4444;
            --accent-green: #10b981;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text-main); padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; background: var(--card-bg); padding: 30px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.4); }

        .tabs { display: flex; margin-bottom: 30px; background: rgba(0,0,0,0.2); border-radius: 12px; padding: 5px; }
        .tab-btn { flex: 1; padding: 14px; border: none; background: none; color: #94a3b8; font-weight: bold; cursor: pointer; border-radius: 10px; }
        .tab-btn.active { background: var(--primary); color: #000; }

        .content { display: none; }
        .content.active { display: block; }

        .split-row { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .r-text { font-size: 28px; font-weight: 900; color: var(--primary); }

        input { width: 100%; padding: 14px; background: #334155; border: 1px solid #475569; color: white; border-radius: 12px; font-size: 16px; outline: none; }
        input:focus { border-color: var(--primary); }

        /* Refresh Button Green */
        .refresh-btn { background: var(--accent-green) !important; color: white !important; margin-bottom: 20px; font-size: 18px; }

        .main-btn { width: 100%; padding: 15px; background: var(--primary); color: black; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }

        .bet-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        @media (max-width: 768px) { .bet-layout { grid-template-columns: 1fr; } }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .progress-bg { background: #334155; border-radius: 10px; height: 8px; width: 100%; margin-top: 5px; overflow: hidden; }
        .progress-fill { background: var(--accent-green); height: 100%; transition: 0.5s; }
        .limit-warning { background: var(--accent-red) !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('bet-tab', event)">·Äë·Ä≠·ÄØ·Ä∏·Äû·Ä¨·Ä∏</button>
        <button class="tab-btn" onclick="openTab('admin-tab', event)">·Äí·Ä≠·ÄØ·ÄÑ·Ä∫ (·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄØ·Äï·Ä∫)</button>
    </div>

    <div id="bet-tab" class="content active">
        <div class="bet-layout">
            <div>
                <h2>3D Betting</h2>
                <div class="split-row">
                    <input type="number" id="betNum" placeholder="·ÄÇ·Äè·Äî·Ä∫·Ä∏">
                    <span class="r-text">R</span>
                    <input type="number" id="rAmount" placeholder="R ·Äï·Äô·Ä¨·Äè">
                </div>
                <input type="number" id="straightAmount" placeholder="·Ä°·Äñ·Äº·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫ ·Äï·Äô·Ä¨·Äè" style="margin-bottom:15px">
                <button class="main-btn" id="betBtn" onclick="processBet()">·Ä°·Äô·Äº·Äî·Ä∫·Äë·Ä≠·ÄØ·Ä∏·Äô·Ää·Ä∫</button>
            </div>
            <div>
                <h3 style="color:#94a3b8">·Äú·Äê·Ä∫·Äê·Äú·Ä±·Ä¨·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏</h3>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table id="betTable">
                        <tbody id="betList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-tab" class="content">
        <button class="main-btn refresh-btn" onclick="loadDashboard()">üîÑ ·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·ÄÅ·Äª·ÄØ·Äï·Ä∫ Refresh ·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫</button>
        <div id="statList"></div>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwLmQPwr-ev4P4XIWHFHlcPFrfUo73YPJZsSUNVrQ4N2JORA64bMtwgzcwE_mtHry4U3g/exec'; // ·Ä°·Äõ·Ä±·Ä∏·ÄÄ·Äº·ÄÆ·Ä∏

    function openTab(tabId, event) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function getPermutations(str) {
        if (str.length <= 1) return [str];
        let perms = [];
        for (let i = 0; i < str.length; i++) {
            let char = str[i], rem = str.slice(0, i) + str.slice(i + 1);
            for (let sub of getPermutations(rem)) perms.push(char + sub);
        }
        return [...new Set(perms)];
    }

    async function processBet() {
        const num = document.getElementById('betNum').value;
        const sAmt = document.getElementById('straightAmount').value;
        const rAmt = document.getElementById('rAmount').value;
        if (num.length !== 3) return alert("·ÄÇ·Äè·Äî·Ä∫·Ä∏ ·ÅÉ ·Äú·ÄØ·Ä∂·Ä∏·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´");

        const btn = document.getElementById('betBtn');
        btn.disabled = true; btn.innerText = "·Äï·Ä≠·ÄØ·Ä∑·Äî·Ä±·Äû·Ää·Ä∫...";

        let tasks = [];
        if (sAmt > 0) tasks.push(sendBet(num, sAmt, "Straight"));
        if (rAmt > 0) getPermutations(num).forEach(n => tasks.push(sendBet(n, rAmt, "R")));

        await Promise.all(tasks);
        btn.disabled = false; btn.innerText = "·Ä°·Äô·Äº·Äî·Ä∫·Äë·Ä≠·ÄØ·Ä∏·Äô·Ää·Ä∫";
        document.getElementById('betNum').value = ""; document.getElementById('straightAmount').value = ""; document.getElementById('rAmount').value = "";
    }

    async function sendBet(n, amt, type) {
        try {
            const res = await fetch(`${scriptURL}?num=${n}&amount=${amt}&t=${Date.now()}`);
            const result = await res.text();
            const color = result === "SUCCESS" ? "#10b981" : "#ef4444";
            const row = `<tr><td><b>${n}</b> (${type})</td><td>${amt}</td><td style="color:${color}">${result}</td></tr>`;
            document.getElementById('betList').innerHTML = row + document.getElementById('betList').innerHTML;
        } catch(e) { console.log(e); }
    }

    async function loadDashboard() {
        const div = document.getElementById('statList');
        div.innerHTML = "Loading...";
        try {
            const res = await fetch(`${scriptURL}?action=dashboard&t=${Date.now()}`);
            const data = await res.json();
            let html = "<table>";
            for(let n in data.topNumbers) {
                let amt = data.topNumbers[n], per = (amt/data.limit)*100;
                html += `<tr><td><b>${n}</b></td><td style="width:70%">
                    <div style="display:flex; justify-content:space-between; font-size:12px"><span>${amt} Ks</span><span>${Math.round(per)}%</span></div>
                    <div class="progress-bg"><div class="progress-fill ${per > 80 ? 'limit-warning' : ''}" style="width:${per}%"></div></div>
                </td></tr>`;
            }
            div.innerHTML = html + "</table>";
        } catch(e) { div.innerHTML = "Error!"; }
    }
</script>
</body>
</html>
